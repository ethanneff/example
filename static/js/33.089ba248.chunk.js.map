{"version":3,"sources":["apps/Playground/Drift/Canvas.tsx","apps/Playground/Drift/Context.tsx","apps/Playground/Drift/Dpad.tsx","apps/Playground/Drift/Character.tsx","apps/Playground/Drift/utils.ts","apps/Playground/Drift/Tracks.tsx","apps/Playground/Drift/Game.tsx","apps/Playground/Drift/index.tsx"],"names":["Canvas","memo","children","onLayout","color","useColor","View","style","flex","backgroundColor","surface","driftInitialState","tracks","driftReducer","state","action","type","payload","length","pop","DriftContext","createContext","dispatch","Dpad","useShadow","useDropShadow","useContext","box","width","height","onPress","useCallback","position","bottom","right","transform","rotate","flexDirection","info","borderTopLeftRadius","success","borderTopRightRadius","primary","borderBottomLeftRadius","warning","borderBottomRightRadius","Character","canvas","initialPositionRef","useRef","x","y","Animated","ValueXY","current","useDriver","useNativeDriver","animate","dx","dy","toValue","change","size","getPosition","spring","start","useEffect","setUpdateIntervalForType","SensorTypes","accelerometer","acc","subscribe","unsubscribe","getLayout","borderRadius","elevation","shadowColor","text","shadowOffset","shadowOpacity","shadowRadius","zIndex","Track","track","styles","StyleSheet","create","opacity","top","left","Tracks","map","index","key","Game","useState","setCanvas","onCanvasLayout","event","nativeEvent","layout","nav","useNav","useReducer","isEmulator","DeviceInfo","isEmulatorSync","border","onLeftPress","to","title","Provider","value","center"],"mappings":"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","file":"static/js/33.089ba248.chunk.js","sourcesContent":["import React, {ReactNode, memo} from 'react';\nimport {LayoutChangeEvent, View} from 'react-native';\nimport {useColor} from '../../../hooks';\n\ninterface Props {\n  onLayout: (event: LayoutChangeEvent) => void;\n  children: ReactNode;\n}\n\nexport const Canvas = memo(function Canvas({children, onLayout}: Props) {\n  const color = useColor();\n  return (\n    <View onLayout={onLayout} style={{flex: 1, backgroundColor: color.surface}}>\n      {children}\n    </View>\n  );\n});\n","import {createContext} from 'react';\nimport {TrackPosition, TrackPositionWithColor} from './Tracks';\nimport {ColorChoice} from './Dpad';\n\nexport type DriftState = {\n  tracks: TrackPositionWithColor[];\n  color: ColorChoice;\n};\n\nexport const driftInitialState: DriftState = {\n  tracks: [],\n  color: 'lightgrey',\n};\n\ntype Action =\n  | {type: 'addColor'; payload: ColorChoice}\n  | {type: 'addTrack'; payload: TrackPosition};\n\nexport const driftReducer = (state: DriftState, action: Action) => {\n  switch (action.type) {\n    case 'addColor':\n      return {...state, color: action.payload};\n    case 'addTrack': {\n      const tracks = [...state.tracks];\n      while (tracks.length > 10) {\n        tracks.pop();\n      }\n      return {\n        ...state,\n        tracks: [{...action.payload, color: state.color}, ...tracks],\n      };\n    }\n    default:\n      return state;\n  }\n};\n\ntype Context = {\n  state: DriftState;\n  dispatch: (action: Action) => void;\n};\n\nexport const DriftContext = createContext<Context>({\n  state: driftInitialState,\n  dispatch: () => undefined,\n});\n","import React, {memo, useCallback, useContext} from 'react';\nimport {View} from 'react-native';\nimport {useColor, useDropShadow} from '../../../hooks';\nimport {TouchableOpacity} from '../../../components';\nimport {DriftContext} from './Context';\n\nexport type ColorChoice =\n  | 'slateblue'\n  | 'orange'\n  | 'mediumseagreen'\n  | 'violet'\n  | 'lightgrey';\n\nexport const Dpad = memo(function Dpad() {\n  const useShadow = useDropShadow(10);\n  const {dispatch} = useContext(DriftContext);\n  const color = useColor();\n  const size = 50;\n  const box = {\n    width: size,\n    height: size,\n  };\n\n  const onPress = useCallback(\n    (payload: ColorChoice) => () => dispatch({type: 'addColor', payload}),\n    [dispatch],\n  );\n\n  return (\n    <View\n      style={{\n        position: 'absolute',\n        bottom: size,\n        right: size,\n        transform: [{rotate: '45deg'}],\n      }}>\n      <View style={{flexDirection: 'row'}}>\n        <TouchableOpacity\n          onPress={onPress('violet')}\n          style={{\n            ...box,\n            backgroundColor: color.info,\n            borderTopLeftRadius: size,\n            ...useShadow,\n          }}\n        />\n        <TouchableOpacity\n          onPress={onPress('mediumseagreen')}\n          style={{\n            ...box,\n            backgroundColor: color.success,\n            borderTopRightRadius: size,\n            ...useShadow,\n          }}\n        />\n      </View>\n      <View style={{flexDirection: 'row'}}>\n        <TouchableOpacity\n          onPress={onPress('slateblue')}\n          style={{\n            ...box,\n            backgroundColor: color.primary,\n            borderBottomLeftRadius: size,\n            ...useShadow,\n          }}\n        />\n        <TouchableOpacity\n          onPress={onPress('orange')}\n          style={{\n            ...box,\n            backgroundColor: color.warning,\n            borderBottomRightRadius: size,\n            ...useShadow,\n          }}\n        />\n      </View>\n    </View>\n  );\n});\n","import React, {memo, useCallback, useContext, useEffect, useRef} from 'react';\nimport {Animated} from 'react-native';\nimport {\n  SensorTypes,\n  accelerometer,\n  setUpdateIntervalForType,\n} from 'react-native-sensors';\nimport {useColor, useNativeDriver} from '../../../hooks';\nimport {getPosition} from './utils';\nimport {DriftContext} from './Context';\nimport {CanvasDimensions} from './Game';\n\ntype CharacterProps = {\n  canvas: CanvasDimensions;\n};\n\nexport const Character = memo(function Character({canvas}: CharacterProps) {\n  const elevation = 5;\n  const size = 30;\n  const speed = 6;\n  const rate = 16;\n  const shadowOpacity = elevation * 0.036 + 0.12;\n  const shadowRadius = elevation * 0.36 + 1.2;\n  const initialPositionRef = useRef({\n    x: canvas.width / 2 - size,\n    y: canvas.height / 2 - size,\n  });\n  const position = new Animated.ValueXY(initialPositionRef.current);\n  const useDriver = useNativeDriver();\n  const {dispatch} = useContext(DriftContext);\n  const color = useColor();\n\n  const animate = useCallback(\n    (dx: number, dy: number) => {\n      const toValue = getPosition({\n        canvas,\n        change: {dx: dx * speed, dy: dy * speed},\n        current: initialPositionRef.current,\n        size,\n      });\n      initialPositionRef.current = toValue;\n      dispatch({type: 'addTrack', payload: {...toValue, size}});\n      Animated.spring(position, {\n        toValue,\n        useNativeDriver: useDriver,\n      }).start();\n    },\n    [canvas, dispatch, position, useDriver],\n  );\n\n  useEffect(() => {\n    setUpdateIntervalForType(SensorTypes.accelerometer, rate);\n    const acc = accelerometer.subscribe(({x, y}) => animate(x, y));\n    return () => {\n      acc.unsubscribe();\n    };\n  }, [rate, animate]);\n\n  return (\n    <Animated.View\n      style={[\n        position.getLayout(),\n        {\n          width: size,\n          height: size,\n          borderRadius: size,\n          elevation,\n          shadowColor: color.text,\n          shadowOffset: {\n            height: 2,\n            width: 0,\n          },\n          shadowOpacity,\n          shadowRadius,\n          zIndex: elevation,\n          backgroundColor: color.primary,\n        },\n      ]}\n    />\n  );\n});\n","type Position = {\n  change: {dx: number; dy: number};\n  canvas: {x: number; y: number; width: number; height: number};\n  current: {x: number; y: number};\n  size: number;\n};\n\nexport const getPosition = (position: Position) => {\n  const dx = position.current.x - position.change.dx;\n  const dy = position.current.y + position.change.dy;\n  const y =\n    dy < 0\n      ? 0\n      : dy + position.size > position.canvas.height\n      ? position.canvas.height - position.size\n      : dy;\n  const x =\n    dx < 0\n      ? 0\n      : dx + position.size > position.canvas.width\n      ? position.canvas.width - position.size\n      : dx;\n  return {x, y};\n};\n","import React, {memo, useContext} from 'react';\nimport {StyleSheet, View} from 'react-native';\nimport {ColorChoice} from './Dpad';\nimport {DriftContext} from './Context';\n\nexport type TrackPosition = {x: number; y: number; size: number};\nexport type TrackPositionWithColor = TrackPosition & {color: ColorChoice};\n\ninterface TrackProps {\n  track: TrackPositionWithColor;\n}\n\nconst Track = memo(function TrackMemo({track}: TrackProps) {\n  const size = track.size / 4;\n  const styles = StyleSheet.create({\n    tracks: {\n      backgroundColor: track.color,\n      borderRadius: track.size,\n      height: size,\n      opacity: 0.4,\n      position: 'absolute',\n      width: size,\n    },\n  });\n  return (\n    <>\n      <View\n        style={{\n          ...styles.tracks,\n          top: track.y - track.size / 2 - size / 2,\n          left: track.x + track.size / 2 - track.size / 2,\n        }}\n      />\n      <View\n        style={{\n          ...styles.tracks,\n          top: track.y - track.size / 2 - size / 2,\n          left: track.x + track.size / 2 + track.size / 2 - size,\n        }}\n      />\n    </>\n  );\n});\n\nexport const Tracks = memo(function TracksMemo() {\n  const {state} = useContext(DriftContext);\n  return (\n    <>\n      {state.tracks.map((track: TrackPositionWithColor, index: number) => (\n        <Track key={`${track.x}${track.y}${index}`} track={track} />\n      ))}\n    </>\n  );\n});\n","import React, {memo, useCallback, useState} from 'react';\nimport {LayoutChangeEvent, View} from 'react-native';\nimport {Canvas} from './Canvas';\nimport {Dpad} from './Dpad';\nimport {Character} from './Character';\nimport {Tracks} from './Tracks';\n\nexport type CanvasDimensions = {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n};\n\nexport const Game = memo(function Game() {\n  const [canvas, setCanvas] = useState<CanvasDimensions | null>(null);\n\n  const onCanvasLayout = useCallback((event: LayoutChangeEvent) => {\n    const {x, y, height, width} = event.nativeEvent.layout;\n    setCanvas({x, y, height, width});\n  }, []);\n\n  return (\n    <View style={{flex: 1}}>\n      <Canvas onLayout={onCanvasLayout}>\n        {canvas && (\n          <>\n            <Character canvas={canvas} />\n            <Tracks />\n          </>\n        )}\n      </Canvas>\n      <Dpad />\n    </View>\n  );\n});\n","import DeviceInfo from 'react-native-device-info';\nimport React, {memo, useReducer} from 'react';\nimport {Screen, Text} from '../../../components';\nimport {useNav} from '../../../hooks';\nimport {Game} from './Game';\nimport {DriftContext, driftInitialState, driftReducer} from './Context';\n\nexport default memo(function PlaygroundDrift() {\n  const nav = useNav();\n  const [state, dispatch] = useReducer(driftReducer, driftInitialState);\n  const isEmulator = DeviceInfo.isEmulatorSync();\n\n  // TODO: figure out why Screen re-renders\n  return (\n    <Screen border onLeftPress={nav.to('playground')} title=\"Drift\">\n      <DriftContext.Provider value={{state, dispatch}}>\n        {isEmulator ? (\n          <Text center title=\"simulators not supported\" />\n        ) : (\n          <Game />\n        )}\n      </DriftContext.Provider>\n    </Screen>\n  );\n});\n"],"sourceRoot":""}